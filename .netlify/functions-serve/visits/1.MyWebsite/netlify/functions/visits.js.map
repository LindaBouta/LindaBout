{
  "version": 3,
  "sources": ["file:///E:/1.MyWebsite/netlify/functions/visits.mjs"],
  "sourceRoot": "C:/Users/linda/AppData/Local/Temp/tmp-12712-5WDblQDd5gSN",
  "sourcesContent": ["// netlify/functions/visits.mjs\r\nexport const config = { path: \"/.netlify/functions/visits\" };\r\n\r\nconst COUNTERAPI_KEY = process.env.COUNTERAPI_KEY || \"ut_7Uo9GPMvyfkWksgyQ76McMTUQ50SE43bNDSyGaZp\";\r\n// you can use a namespace + key or full name like \"lindabout/visits\"\r\nconst COUNTERAPI_COUNTER = process.env.COUNTERAPI_COUNTER || \"First Counter\";\r\nconst TIMEOUT_MS = 4000;\r\n\r\n// fallback CountAPI.xyz\r\nconst COUNTAPI_NS = \"lindabout.com\";\r\nconst COUNTAPI_KEY_FALLBACK = \"visits\";\r\n\r\n// helper: timeout wrapper for fetch\r\nfunction timeoutFetch(input, init, ms = TIMEOUT_MS) {\r\n  const ctrl = new AbortController();\r\n  const id = setTimeout(() => ctrl.abort(), ms);\r\n  return fetch(input, { ...init, signal: ctrl.signal }).finally(() =>\r\n    clearTimeout(id)\r\n  );\r\n}\r\n\r\n// ---- CounterAPI.dev implementation ----\r\nasync function counterapiHit() {\r\n  const url = `https://counterapi.dev/api/v1/${COUNTERAPI_COUNTER}/increment`;\r\n\r\n  const res = await timeoutFetch(url, {\r\n    method: \"POST\",\r\n    headers: {\r\n      Authorization: `Bearer ${COUNTERAPI_KEY}`,\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: JSON.stringify({ amount: 1 }),\r\n  });\r\n\r\n  const txt = await res.text();\r\n  let json;\r\n  try {\r\n    json = JSON.parse(txt);\r\n  } catch {\r\n    json = { raw: txt };\r\n  }\r\n\r\n  if (!res.ok)\r\n    throw new Error(`CounterAPI.dev ${res.status}: ${txt.slice(0, 100)}`);\r\n\r\n  const value = Number(json?.value ?? json?.count ?? json?.total ?? 0);\r\n  if (!Number.isFinite(value)) throw new Error(\"invalid numeric response\");\r\n  return value;\r\n}\r\n\r\nasync function counterapiGet() {\r\n  const url = `https://counterapi.dev/api/v1/${COUNTERAPI_COUNTER}`;\r\n  const res = await timeoutFetch(url, {\r\n    headers: { Authorization: `Bearer ${COUNTERAPI_KEY}` },\r\n  });\r\n\r\n  const txt = await res.text();\r\n  let json;\r\n  try {\r\n    json = JSON.parse(txt);\r\n  } catch {\r\n    json = { raw: txt };\r\n  }\r\n\r\n  if (!res.ok)\r\n    throw new Error(`CounterAPI.dev ${res.status}: ${txt.slice(0, 100)}`);\r\n\r\n  const value = Number(json?.value ?? json?.count ?? json?.total ?? 0);\r\n  if (!Number.isFinite(value)) throw new Error(\"invalid numeric response\");\r\n  return value;\r\n}\r\n\r\n// ---- CountAPI.xyz fallback ----\r\nasync function countapiXYZHit() {\r\n  const url = `https://api.countapi.xyz/hit/${COUNTAPI_NS}/${COUNTAPI_KEY_FALLBACK}`;\r\n  const res = await timeoutFetch(url);\r\n  const j = await res.json().catch(() => ({}));\r\n  const value = Number(j?.value ?? 0);\r\n  if (!Number.isFinite(value)) throw new Error(\"invalid countapi.xyz response\");\r\n  return value;\r\n}\r\n\r\nasync function countapiXYZGet() {\r\n  const url = `https://api.countapi.xyz/get/${COUNTAPI_NS}/${COUNTAPI_KEY_FALLBACK}`;\r\n  const res = await timeoutFetch(url);\r\n  const j = await res.json().catch(() => ({}));\r\n  const value = Number(j?.value ?? 0);\r\n  if (!Number.isFinite(value)) throw new Error(\"invalid countapi.xyz response\");\r\n  return value;\r\n}\r\n\r\n// ---- Main handler ----\r\nexport async function handler(event) {\r\n  const mode = (event.queryStringParameters?.mode || \"hit\").toLowerCase();\r\n  const useCounterApi = Boolean(COUNTERAPI_KEY);\r\n\r\n  try {\r\n    let value;\r\n    if (mode === \"get\") {\r\n      value = useCounterApi ? await counterapiGet() : await countapiXYZGet();\r\n    } else {\r\n      value = useCounterApi ? await counterapiHit() : await countapiXYZHit();\r\n    }\r\n\r\n    return {\r\n      statusCode: 200,\r\n      headers: { \"content-type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        value,\r\n        backend: useCounterApi ? \"CounterAPI.dev\" : \"CountAPI.xyz\",\r\n      }),\r\n    };\r\n  } catch (err) {\r\n    return {\r\n      statusCode: 200,\r\n      headers: { \"content-type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        value: 0,\r\n        backend: useCounterApi ? \"CounterAPI.dev\" : \"CountAPI.xyz\",\r\n        error: String(err?.message || err),\r\n      }),\r\n    };\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACO,IAAM,SAAS,EAAE,MAAM,6BAA6B;AAE3D,IAAM,iBAAiB,QAAQ,IAAI,kBAAkB;AAErD,IAAM,qBAAqB,QAAQ,IAAI,sBAAsB;AAC7D,IAAM,aAAa;AAGnB,IAAM,cAAc;AACpB,IAAM,wBAAwB;AAG9B,SAAS,aAAa,OAAO,MAAM,KAAK,YAAY;AAClD,QAAM,OAAO,IAAI,gBAAgB;AACjC,QAAM,KAAK,WAAW,MAAM,KAAK,MAAM,GAAG,EAAE;AAC5C,SAAO,MAAM,OAAO,EAAE,GAAG,MAAM,QAAQ,KAAK,OAAO,CAAC,EAAE;AAAA,IAAQ,MAC5D,aAAa,EAAE;AAAA,EACjB;AACF;AAGA,eAAe,gBAAgB;AAC7B,QAAM,MAAM,iCAAiC,kBAAkB;AAE/D,QAAM,MAAM,MAAM,aAAa,KAAK;AAAA,IAClC,QAAQ;AAAA,IACR,SAAS;AAAA,MACP,eAAe,UAAU,cAAc;AAAA,MACvC,gBAAgB;AAAA,IAClB;AAAA,IACA,MAAM,KAAK,UAAU,EAAE,QAAQ,EAAE,CAAC;AAAA,EACpC,CAAC;AAED,QAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,MAAI;AACJ,MAAI;AACF,WAAO,KAAK,MAAM,GAAG;AAAA,EACvB,QAAQ;AACN,WAAO,EAAE,KAAK,IAAI;AAAA,EACpB;AAEA,MAAI,CAAC,IAAI;AACP,UAAM,IAAI,MAAM,kBAAkB,IAAI,MAAM,KAAK,IAAI,MAAM,GAAG,GAAG,CAAC,EAAE;AAEtE,QAAM,QAAQ,OAAO,MAAM,SAAS,MAAM,SAAS,MAAM,SAAS,CAAC;AACnE,MAAI,CAAC,OAAO,SAAS,KAAK,EAAG,OAAM,IAAI,MAAM,0BAA0B;AACvE,SAAO;AACT;AAEA,eAAe,gBAAgB;AAC7B,QAAM,MAAM,iCAAiC,kBAAkB;AAC/D,QAAM,MAAM,MAAM,aAAa,KAAK;AAAA,IAClC,SAAS,EAAE,eAAe,UAAU,cAAc,GAAG;AAAA,EACvD,CAAC;AAED,QAAM,MAAM,MAAM,IAAI,KAAK;AAC3B,MAAI;AACJ,MAAI;AACF,WAAO,KAAK,MAAM,GAAG;AAAA,EACvB,QAAQ;AACN,WAAO,EAAE,KAAK,IAAI;AAAA,EACpB;AAEA,MAAI,CAAC,IAAI;AACP,UAAM,IAAI,MAAM,kBAAkB,IAAI,MAAM,KAAK,IAAI,MAAM,GAAG,GAAG,CAAC,EAAE;AAEtE,QAAM,QAAQ,OAAO,MAAM,SAAS,MAAM,SAAS,MAAM,SAAS,CAAC;AACnE,MAAI,CAAC,OAAO,SAAS,KAAK,EAAG,OAAM,IAAI,MAAM,0BAA0B;AACvE,SAAO;AACT;AAGA,eAAe,iBAAiB;AAC9B,QAAM,MAAM,gCAAgC,WAAW,IAAI,qBAAqB;AAChF,QAAM,MAAM,MAAM,aAAa,GAAG;AAClC,QAAM,IAAI,MAAM,IAAI,KAAK,EAAE,MAAM,OAAO,CAAC,EAAE;AAC3C,QAAM,QAAQ,OAAO,GAAG,SAAS,CAAC;AAClC,MAAI,CAAC,OAAO,SAAS,KAAK,EAAG,OAAM,IAAI,MAAM,+BAA+B;AAC5E,SAAO;AACT;AAEA,eAAe,iBAAiB;AAC9B,QAAM,MAAM,gCAAgC,WAAW,IAAI,qBAAqB;AAChF,QAAM,MAAM,MAAM,aAAa,GAAG;AAClC,QAAM,IAAI,MAAM,IAAI,KAAK,EAAE,MAAM,OAAO,CAAC,EAAE;AAC3C,QAAM,QAAQ,OAAO,GAAG,SAAS,CAAC;AAClC,MAAI,CAAC,OAAO,SAAS,KAAK,EAAG,OAAM,IAAI,MAAM,+BAA+B;AAC5E,SAAO;AACT;AAGA,eAAsB,QAAQ,OAAO;AACnC,QAAM,QAAQ,MAAM,uBAAuB,QAAQ,OAAO,YAAY;AACtE,QAAM,gBAAgB,QAAQ,cAAc;AAE5C,MAAI;AACF,QAAI;AACJ,QAAI,SAAS,OAAO;AAClB,cAAQ,gBAAgB,MAAM,cAAc,IAAI,MAAM,eAAe;AAAA,IACvE,OAAO;AACL,cAAQ,gBAAgB,MAAM,cAAc,IAAI,MAAM,eAAe;AAAA,IACvE;AAEA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU;AAAA,QACnB;AAAA,QACA,SAAS,gBAAgB,mBAAmB;AAAA,MAC9C,CAAC;AAAA,IACH;AAAA,EACF,SAAS,KAAK;AACZ,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU;AAAA,QACnB,OAAO;AAAA,QACP,SAAS,gBAAgB,mBAAmB;AAAA,QAC5C,OAAO,OAAO,KAAK,WAAW,GAAG;AAAA,MACnC,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
